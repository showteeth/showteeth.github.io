<!DOCTYPE html><html class="theme-next mist" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><script></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/dark_logo_180x180.jpg?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/dark_logo_32x32.jpg?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/dark_logo_16x16.jpg?v=5.1.4"><link rel="mask-icon" href="/images/dark_logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="常用基本命令,"><link rel="alternate" href="/atom.xml" title="showteeth's blog" type="application/atom+xml"><meta name="description" content="这篇文章学习了Linux中强大的并行工具parallel，其主要有两种工作模式：给命令传递参数以及管道模式(--pipe参数)，在实际使用中其主要作用在于改写for循环、减少重复性的操作。"><meta name="keywords" content="常用基本命令"><meta property="og:type" content="article"><meta property="og:title" content="Linux系列之parallel-并行化工具"><meta property="og:url" content="http://showteeth.tech/posts/25074.html"><meta property="og:site_name" content="showteeth&#39;s blog"><meta property="og:description" content="这篇文章学习了Linux中强大的并行工具parallel，其主要有两种工作模式：给命令传递参数以及管道模式(--pipe参数)，在实际使用中其主要作用在于改写for循环、减少重复性的操作。"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-08-24T08:06:53.438Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Linux系列之parallel-并行化工具"><meta name="twitter:description" content="这篇文章学习了Linux中强大的并行工具parallel，其主要有两种工作模式：给命令传递参数以及管道模式(--pipe参数)，在实际使用中其主要作用在于改写for循环、减少重复性的操作。"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://showteeth.tech/posts/25074.html"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/9d02ffb0.js","daovoice"),daovoice("init",{app_id:"9d02ffb0"}),daovoice("update")</script><title>Linux系列之parallel-并行化工具 | showteeth's blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><a href="https://github.com/showteeth" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">showteeth's blog</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-photos"><a href="/photos" rel="section"><i class="menu-item-icon fa fa-fw fa-camera"></i><br>相册</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://showteeth.tech/posts/25074.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="showteeth"><meta itemprop="description" content><meta itemprop="image" content="/images/timg.jfif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="showteeth's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Linux系列之parallel-并行化工具</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-18T17:36:41+08:00">2019-08-18 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2019-08-24T16:06:53+08:00">2019-08-24 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span> </a></span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/常用基本命令/" itemprop="url" rel="index"><span itemprop="name">常用基本命令</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/posts/25074.html#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/posts/25074.html" itemprop="commentCount"></span> </a></span><span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-file-o"></i> 本文总阅读量 <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次</span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">4.5k 字 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">20 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><div class="note info"><p>这篇文章学习了Linux中强大的并行工具<code>parallel</code>，其主要有<strong>两种工作模式</strong>：给<strong>命令传递参数</strong>以及<strong>管道模式(<code>--pipe</code>参数)</strong>，在实际使用中其主要作用在于<strong>改写for循环、减少重复性的操作</strong>。</p></div><a id="more"></a><h2 id="parallel介绍"><a href="#parallel介绍" class="headerlink" title="parallel介绍"></a>parallel介绍</h2><p><a href="https://www.gnu.org/software/parallel/" target="_blank" rel="noopener">官网介绍</a>：</p><blockquote><p>GNU parallel is a shell tool for <strong>executing jobs in parallel using one or more computers</strong>. A job can be a <strong>single command</strong> or <strong>a small script</strong> that has to be <strong>run for each of the lines in the input</strong>. The typical input is <strong>a list of files</strong>, <strong>a list of hosts</strong>, <strong>a list of users</strong>, <strong>a list of URLs</strong>, or <strong>a list of tables</strong>. A job can also be a command that <strong>reads from a pipe</strong>. GNU parallel can then <strong>split the input and pipe it into commands in parallel</strong>.</p><p>If you use <strong>xargs</strong> and tee today you will find GNU parallel very easy to use as GNU parallel is written to <strong>have the same options as xargs</strong>. If you write <strong>loops in shell</strong>, you will find GNU parallel may be able to <strong>replace most of the loops and make them run faster</strong> by running several jobs in parallel.</p><p>GNU parallel makes sure output from the commands is the same output as you would get had you run the commands sequentially. This makes it possible to use output from GNU parallel as input for other programs.</p><p>For each line of input GNU parallel will execute command with the line as arguments. If no command is given, the line of input is executed. Several lines will be run in parallel. <strong>GNU parallel can often be used as a substitute for xargs or cat | bash.</strong></p></blockquote><hr><p><br></p><h2 id="安装parallel"><a href="#安装parallel" class="headerlink" title="安装parallel"></a>安装parallel</h2><p>parallel并不是系统自带的命令，所以需要先下载安装才可以正常使用，这里是<strong>非root</strong>下的下载安装过程，root下要简单很多，具体的<a href="https://ftp.gnu.org/gnu/parallel/" target="_blank" rel="noopener">下载地址</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line">wget https://ftp.gnu.org/gnu/parallel/parallel-20190722.tar.bz2</span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -jxvf parallel-20190722.tar.bz2</span><br><span class="line"><span class="comment"># 为编译做准备</span></span><br><span class="line">./configure --prefix=`<span class="built_in">pwd</span>`</span><br><span class="line"><span class="comment"># 编译</span></span><br><span class="line">make</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">make install</span><br><span class="line"><span class="comment"># 测试安装是否成功</span></span><br><span class="line"><span class="built_in">cd</span> bin </span><br><span class="line">./parallel --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑环境变量</span></span><br></pre></td></tr></table></figure><hr><p><br></p><h2 id="parallel命令格式"><a href="#parallel命令格式" class="headerlink" title="parallel命令格式"></a>parallel命令格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line"><span class="comment"># 模式一：传递参数给command</span></span><br><span class="line">parallel [options] [<span class="built_in">command</span> [arguments]] &lt; list_of_arguments</span><br><span class="line">parallel [options] [<span class="built_in">command</span> [arguments]] (::: arguments|:::: argfile(s))...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模式二：pipe模式，给command传递stdin</span></span><br><span class="line">cat ... | parallel --pipe [options] [<span class="built_in">command</span> [arguments]]</span><br></pre></td></tr></table></figure><h2 id="parallel使用示例"><a href="#parallel使用示例" class="headerlink" title="parallel使用示例"></a>parallel使用示例</h2><h3 id="参数输入方式"><a href="#参数输入方式" class="headerlink" title="参数输入方式"></a>参数输入方式</h3><h4 id="命令行输入"><a href="#命令行输入" class="headerlink" title="命令行输入"></a>命令行输入</h4><p><code>tee命令</code>：<code>Linux tee</code>命令将<strong>数据重定向到文件</strong>，<strong>另一方面</strong>还可以提供一份重定向数据的副本<strong>作为后续命令的stdin</strong>。简单的说就是<strong>把数据重定向到给定文件和屏幕上。</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单个输入源</span></span><br><span class="line">parallel <span class="built_in">echo</span> ::: a b c d e |tee test.txt</span><br><span class="line">  a</span><br><span class="line">  b</span><br><span class="line">  c</span><br><span class="line">  d</span><br><span class="line">  e</span><br></pre></td></tr></table></figure><p>第一次使用还会输出引用的提示：</p><blockquote><p>Academic tradition requires you to cite works you base your article on.<br>If you use programs that use GNU Parallel to process data for an article in a<br>scientific publication, please cite:</p><p>O. Tange (2018): GNU Parallel 2018, Mar 2018, ISBN 9781387509881,<br>DOI <a href="https://doi.org/10.5281/zenodo.1146014" target="_blank" rel="noopener">https://doi.org/10.5281/zenodo.1146014</a></p><p>This helps funding further development; AND IT WON’T COST YOU A CENT.<br>If you pay 10000 EUR you should feel free to use GNU Parallel without citing.</p><p>More about funding GNU Parallel and the citation notice:<br><a href="https://www.gnu.org/software/parallel/parallel_design.html#Citation-notice" target="_blank" rel="noopener">https://www.gnu.org/software/parallel/parallel_design.html#Citation-notice</a></p><p>To silence this citation notice: run ‘parallel –citation’ once.</p></blockquote><hr><h4 id="管道输入"><a href="#管道输入" class="headerlink" title="管道输入"></a>管道输入</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat test.txt |parallel <span class="built_in">echo</span></span><br><span class="line">  a</span><br><span class="line">  b</span><br><span class="line">  c</span><br><span class="line">  d</span><br><span class="line">  e</span><br></pre></td></tr></table></figure><hr><h4 id="文件输入"><a href="#文件输入" class="headerlink" title="文件输入"></a>文件输入</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用重定向符号进行文件输入</span></span><br><span class="line">parallel <span class="built_in">echo</span> &lt; test.txt </span><br><span class="line">  a</span><br><span class="line">  b</span><br><span class="line">  c</span><br><span class="line">  d</span><br><span class="line">  e</span><br><span class="line"></span><br><span class="line"><span class="comment"># ::::输入文件</span></span><br><span class="line">parallel <span class="built_in">echo</span> :::: test.txt</span><br></pre></td></tr></table></figure><hr><h3 id="组合输入的信息"><a href="#组合输入的信息" class="headerlink" title="组合输入的信息"></a>组合输入的信息</h3><p>将输入的信息进行组合，需要指定<strong>多个输入源</strong>，指定多个输入源的方法主要包括：</p><ul><li><strong>多个命令行形式</strong>的输入源</li><li><strong>多个文件形式(-a参数或者::::)</strong>的输入源</li><li><strong>命令行、管道和文件形式的输入源组合</strong></li></ul><h4 id="命令行输入-1"><a href="#命令行输入-1" class="headerlink" title="命令行输入"></a>命令行输入</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">parallel <span class="built_in">echo</span> ::: a b c ::: a b c</span><br><span class="line">  a a</span><br><span class="line">  a b</span><br><span class="line">  a c</span><br><span class="line">  b a</span><br><span class="line">  b b</span><br><span class="line">  b c</span><br><span class="line">  c a</span><br><span class="line">  c b</span><br><span class="line">  c c</span><br></pre></td></tr></table></figure><hr><h4 id="文件输入-1"><a href="#文件输入-1" class="headerlink" title="文件输入"></a>文件输入</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意下面两种方法的echo位置</span></span><br><span class="line">parallel -a test.txt -a test2.txt  <span class="built_in">echo</span></span><br><span class="line">parallel <span class="built_in">echo</span> :::: test.txt test2.txt</span><br><span class="line">  a a</span><br><span class="line">  a b</span><br><span class="line">  a c</span><br><span class="line">  a d</span><br><span class="line">  a e</span><br><span class="line">  b a</span><br><span class="line">  b b</span><br><span class="line">  b c</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><div class="note info"><p>当使用<code>-a</code>传递文件作为参数的时候，<code>-a</code>作为<code>parallel</code>的<strong>参数</strong>在<code>echo</code>命令<strong>前面</strong>；而直接使用<code>::::</code>传递文件作为输入的时候，文件作为<code>arguments</code>在<code>command</code>的<strong>后面</strong>。</p></div><hr><h4 id="混合输入"><a href="#混合输入" class="headerlink" title="混合输入"></a>混合输入</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -a指定文件和管道的组合</span></span><br><span class="line">cat test.txt |parallel -a - -a test2.txt <span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ::::指定文件和管道的组合</span></span><br><span class="line">cat test.txt |parallel <span class="built_in">echo</span> ::::  - test2.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># ::::指定文件和:::指定命令行的组合</span></span><br><span class="line">parallel <span class="built_in">echo</span> ::: a b :::: test.txt</span><br><span class="line">  a a</span><br><span class="line">  a b</span><br><span class="line">  a c</span><br><span class="line">  a d</span><br><span class="line">  a e</span><br><span class="line">  b a</span><br><span class="line">  b b</span><br><span class="line">  b c</span><br><span class="line">  b d</span><br><span class="line">  b e</span><br></pre></td></tr></table></figure><hr><h3 id="取消输入的组合"><a href="#取消输入的组合" class="headerlink" title="取消输入的组合"></a>取消输入的组合</h3><p>如果<strong>不想在进行多个输入源的输入时出现的组合现象</strong>，可以使用<code>--xapply</code>指定从<strong>每个输入源中获取一个参数(或一行)</strong>，<strong>较短的输入源会进行重复直到较长的输入源全部输出</strong>：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 两个输入源长度相同</span></span><br><span class="line">parallel --xapply <span class="built_in">echo</span> ::: a b c ::: d e f </span><br><span class="line">  a d</span><br><span class="line">  b e</span><br><span class="line">  c f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 两个输入源长度不同，较短的重复至较长的输出完</span></span><br><span class="line">parallel --xapply <span class="built_in">echo</span> ::: a b c ::: d e f g h</span><br><span class="line">  a d</span><br><span class="line">  b e</span><br><span class="line">  c f</span><br><span class="line">  a g</span><br><span class="line">  b h</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="指定参数分隔符"><a href="#指定参数分隔符" class="headerlink" title="指定参数分隔符"></a>指定参数分隔符</h3><p>在进行命令行参数输入时，如果遇到<code>:::</code>或<code>::::</code>被占用时，可以使用<code>--arg-sep</code>和<code>--arg-file-sep</code>分别指定命令行和文件的参数分隔符：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定命令行的参数分隔符</span></span><br><span class="line">parallel --xapply --arg-sep ,,, <span class="built_in">echo</span> ,,, a b c ,,, d e f g h</span><br><span class="line">  a d</span><br><span class="line">  b e</span><br><span class="line">  c f</span><br><span class="line">  a g</span><br><span class="line">  b h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定文件的参数分隔符</span></span><br><span class="line">parallel --arg-file-sep ,,, <span class="built_in">echo</span> ,,, test.txt </span><br><span class="line">  a</span><br><span class="line">  b</span><br><span class="line">  c</span><br><span class="line">  d</span><br><span class="line">  e</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="指定参数定界符"><a href="#指定参数定界符" class="headerlink" title="指定参数定界符"></a>指定参数定界符</h3><p>默认的参数定界符为<code>\n</code>，也就是把<strong>每一行当做一个参数</strong>，可以通过参数<code>-d</code>来<strong>改变参数定界符</strong>：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改变参数定界符为\t</span></span><br><span class="line">paste test.txt  test2.txt |parallel -d <span class="string">"\t"</span> <span class="built_in">echo</span> :::: - </span><br><span class="line">  a</span><br><span class="line">  a</span><br><span class="line">  b</span><br><span class="line">  b</span><br><span class="line">  c</span><br><span class="line">  c</span><br><span class="line">  d</span><br><span class="line">  d</span><br><span class="line">  e</span><br><span class="line">  e</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="指定参数结束值"><a href="#指定参数结束值" class="headerlink" title="指定参数结束值"></a>指定参数结束值</h3><p><code>Parallel</code>支持通过<code>-E</code>参数<strong>指定一个值做为结束标志</strong>：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parallel -E stop <span class="built_in">echo</span> ::: A B stop C D</span><br><span class="line">  A</span><br><span class="line">  B</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="跳过空行"><a href="#跳过空行" class="headerlink" title="跳过空行"></a>跳过空行</h3><p><code>Parallel</code>使用 <code>--no-run-if-empty</code> 来跳过空行:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">echo</span> 1; <span class="built_in">echo</span>; <span class="built_in">echo</span> 2) | parallel --no-run-if-empty <span class="built_in">echo</span></span><br><span class="line">  1</span><br><span class="line">  2</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="对输入参数进行替换"><a href="#对输入参数进行替换" class="headerlink" title="对输入参数进行替换"></a>对输入参数进行替换</h3><p>Parallel支持多种方式来对输入的参数进行字符串替换，默认使用的是符号是 <code>{}</code>，也就是<strong>输出原始输入，没有任何替换(占位符)</strong>。其<strong>最常见的字符串替换</strong>如下：</p><ul><li><code>{.}</code>: 去掉<strong>扩展名</strong>；</li><li><code>{/}</code>: <strong>去掉路径</strong>，只<strong>保留文件名</strong>；</li><li><code>{//}</code>: 只<strong>保留路径</strong>；</li><li><code>{/.}</code>: <strong>同时去掉路径和扩展名</strong>；</li><li><code></code>。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输入是A目录下存在B.C这个文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数-I来改变默认的占位符符号&#123;&#125;</span></span><br><span class="line">parallel <span class="built_in">echo</span> ::: A/B.C ; parallel <span class="built_in">echo</span> &#123;&#125; ::: A/B.C ; parallel -I ,, <span class="built_in">echo</span> ,, ::: A/B.C</span><br><span class="line">  A/B.C</span><br><span class="line">  A/B.C</span><br><span class="line">  A/B.C</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去掉输出参数中包括的拓展名信息</span></span><br><span class="line"><span class="comment"># 将默认的&#123;.&#125;替换为,,</span></span><br><span class="line">parallel <span class="built_in">echo</span> &#123;.&#125; ::: A/B.C ; parallel --extensionreplace ,, <span class="built_in">echo</span> ,, ::: A/B.C</span><br><span class="line">  A/B</span><br><span class="line">  A/B</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出输入参数中包括的文件名信息，和basename命令作用相同</span></span><br><span class="line"><span class="comment"># 将默认的&#123;/&#125;修改为,,</span></span><br><span class="line">parallel <span class="built_in">echo</span> &#123;/&#125; ::: A/B.C ; parallel --basenamereplace ,, <span class="built_in">echo</span> ,, ::: A/B.C</span><br><span class="line">  B.C</span><br><span class="line">  B.C</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出输入参数中包括的路径信息</span></span><br><span class="line"><span class="comment"># 将默认的&#123;//&#125;修改为,,</span></span><br><span class="line">parallel <span class="built_in">echo</span> &#123;//&#125; ::: A/B.C ; parallel --dirnamereplace ,, <span class="built_in">echo</span> ,, ::: A/B.C </span><br><span class="line">  A</span><br><span class="line">  A</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出输入参数中的文件名信息(不包括后缀)</span></span><br><span class="line"><span class="comment"># 将默认的&#123;/.&#125;修改为,,</span></span><br><span class="line">parallel <span class="built_in">echo</span> &#123;/.&#125; ::: A/B.C ; parallel --basenameextensionreplace ,, <span class="built_in">echo</span> ,, ::: A/B.C</span><br><span class="line">  B</span><br><span class="line">  B</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入并行的任务编号</span></span><br><span class="line"><span class="comment"># 将默认的&#123;#&#125;修改为,,</span></span><br><span class="line">parallel <span class="built_in">echo</span> &#123;<span class="comment">#&#125; ::: A B C ; parallel --seqreplace ,, echo ,, ::: A B C</span></span><br><span class="line">  1</span><br><span class="line">  2</span><br><span class="line">  3</span><br><span class="line">  1</span><br><span class="line">  2</span><br><span class="line">  3</span><br></pre></td></tr></table></figure><hr><h3 id="指定输入源输出顺序"><a href="#指定输入源输出顺序" class="headerlink" title="指定输入源输出顺序"></a>指定输入源输出顺序</h3><p>如果有多个输入源时，可以通过 <code>{编号}</code> <strong>代指某一个输入源的参数</strong>：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#123;1&#125;表示输入源1中的内容，&#123;2&#125;表示输入源2中的内容</span></span><br><span class="line">parallel --xapply  <span class="built_in">echo</span> &#123;1&#125; and &#123;2&#125; ::: A B ::: C D;parallel --xapply  <span class="built_in">echo</span> &#123;2&#125; and &#123;1&#125; ::: A B ::: C D</span><br><span class="line">  A and C</span><br><span class="line">  B and D</span><br><span class="line">  C and A</span><br><span class="line">  D and B</span><br></pre></td></tr></table></figure><p></p><p>输入源也可以使用<strong>负数指定，表示倒着数</strong>：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">parallel <span class="built_in">echo</span> 1=&#123;1&#125; 2=&#123;2&#125; -1=&#123;-1&#125; -2=&#123;-2&#125; ::: A B ::: C D</span><br><span class="line">  1=A 2=C -1=C -2=A</span><br><span class="line">  1=A 2=D -1=D -2=A</span><br><span class="line">  1=B 2=C -1=C -2=B</span><br><span class="line">  1=B 2=D -1=D -2=B</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="指定参数名和参数"><a href="#指定参数名和参数" class="headerlink" title="指定参数名和参数"></a>指定参数名和参数</h3><p>使用 <code>--header</code>指定每一行输入中的第一个值做为参数名:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parallel --xapply --header : <span class="built_in">echo</span> f1=&#123;f1&#125; f2=&#123;f2&#125; ::: f1 A B ::: f2 C D | tee d.txt</span><br><span class="line">  f1=A f2=C</span><br><span class="line">  f1=B f2=D</span><br></pre></td></tr></table></figure><p></p><p>使用 <code>--colsep</code> 指定列分隔符：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">'printf "f1\tf2\nA\tB\nC\tD\n"'</span> &gt; tsv-file.tsv</span><br><span class="line">parallel --header : --colsep <span class="string">'\t'</span> <span class="built_in">echo</span> f1=&#123;f1&#125; f2=&#123;f2&#125; :::: tsv-file.tsv </span><br><span class="line">  f1=A f2=B</span><br><span class="line">  f1=C f2=D</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="背景文本"><a href="#背景文本" class="headerlink" title="背景文本"></a>背景文本</h3><p>占位符<code>{}</code>可以是<strong>输出字符的一部分</strong>，使用<code>-m</code>参数表示<strong>每个jobs不重复输出背景文本(除去替换字符串之外的字符内容)</strong>，而<code>-X</code>参数与<code>-m</code>参数<strong>功能相反</strong>，会在<strong>每个jobs中都输出背景文本</strong>：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认情况下是会输出背景文本的</span></span><br><span class="line"><span class="comment"># 并且每个参数输出一行</span></span><br><span class="line">parallel  --<span class="built_in">jobs</span> 3 <span class="built_in">echo</span> pre-&#123;&#125;-post ::: A B C D E </span><br><span class="line">  pre-A-post</span><br><span class="line">  pre-B-post</span><br><span class="line">  pre-C-post</span><br><span class="line">  pre-D-post</span><br><span class="line">  pre-E-post</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过-m参数取消在每个jobs中输出背景文本</span></span><br><span class="line"><span class="comment"># 并且同一个jobs中的参数在同一行输出</span></span><br><span class="line">parallel -m --<span class="built_in">jobs</span> 3 <span class="built_in">echo</span> pre-&#123;&#125;-post ::: A B C D E </span><br><span class="line">  pre-A B-post</span><br><span class="line">  pre-C D-post</span><br><span class="line">  pre-E-post</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过-X参数指定在每个jobs中输出背景文本</span></span><br><span class="line"><span class="comment"># 并且同一个jobs中的参数在同一行输出</span></span><br><span class="line">parallel -X --<span class="built_in">jobs</span> 3 <span class="built_in">echo</span> pre-&#123;&#125;-post ::: A B C D E </span><br><span class="line">  pre-A-post pre-B-post</span><br><span class="line">  pre-C-post pre-D-post</span><br><span class="line">  pre-E-post</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="限制每次读取的参数个数"><a href="#限制每次读取的参数个数" class="headerlink" title="限制每次读取的参数个数"></a>限制每次读取的参数个数</h3><p><code>parallel</code>使用 <code>-N</code> 限制每次参数的个数，其中<code>-N0</code>表示一次<strong>只读取一个参数，且不输入这个参数（作为计数器来使用）</strong>:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每次读取四个参数，并将所有读取的参数输出</span></span><br><span class="line"><span class="comment"># 相当于依次把数据分成了四个源，然后进行不带组合的输出</span></span><br><span class="line">parallel -N 4 <span class="built_in">echo</span> 1=&#123;1&#125; 2=&#123;2&#125; 3=&#123;3&#125; 4=&#123;4&#125; ::: A B C D E F G H</span><br><span class="line">  1=A 2=B 3=C 4=D</span><br><span class="line">  1=E 2=F 3=G 4=H</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每次读取四个参数，只输出其中的一部分参数</span></span><br><span class="line">parallel -N 4 <span class="built_in">echo</span> 1=&#123;1&#125; 2=&#123;2&#125; 3=&#123;3&#125;  ::: A B C D E F G H</span><br><span class="line">  1=A 2=B 3=C</span><br><span class="line">  1=E 2=F 3=G</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当做计数器使用，不会输出后续的参数</span></span><br><span class="line">parallel -N 0 <span class="built_in">echo</span> &#123;&#125;_foo ::: A B C</span><br><span class="line">  _foo</span><br><span class="line">  _foo</span><br><span class="line">  _foo</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="去除输入参数的空格"><a href="#去除输入参数的空格" class="headerlink" title="去除输入参数的空格"></a>去除输入参数的空格</h3><p><code>parallel</code>使用<code>--trim</code>去除参数两头的空格，其有三种模式，去除左边的空格(<code>--trim l</code>)、右边的空格(<code>--trim r</code>)、左右的空格(<code>--trim lr</code>)：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 去除右边的空格</span></span><br><span class="line">parallel --trim r <span class="built_in">echo</span> pre-&#123;&#125;-post ::: <span class="string">' A '</span></span><br><span class="line">  pre- A-post</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去除左边的空格</span></span><br><span class="line">parallel --trim l <span class="built_in">echo</span> pre-&#123;&#125;-post ::: <span class="string">' A '</span></span><br><span class="line">  pre-A -post</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去除左右两边的空格</span></span><br><span class="line">parallel --trim lr <span class="built_in">echo</span> pre-&#123;&#125;-post ::: <span class="string">' A '</span></span><br><span class="line">  pre-A-post</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="添加输出前缀"><a href="#添加输出前缀" class="headerlink" title="添加输出前缀"></a>添加输出前缀</h3><p><code>parallel</code>允许使用<code>--tag</code>参数来指定<strong>以参数作为输出字符的前缀</strong>，使用<code>--tagstring</code>来<strong>自定义输出前缀</strong>：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --tag：输入参数作为输出前缀</span></span><br><span class="line">parallel --tag <span class="built_in">echo</span> foo_&#123;&#125; ::: A B C</span><br><span class="line">  A       foo_A</span><br><span class="line">  B       foo_B</span><br><span class="line">  C       foo_C</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改输出前缀</span></span><br><span class="line">parallel --tagstring &#123;&#125;_foo <span class="built_in">echo</span> foo_&#123;&#125; ::: A B C</span><br><span class="line">  A_foo   foo_A</span><br><span class="line">  B_foo   foo_B</span><br><span class="line">  C_foo   foo_C</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="运行之前打印命令"><a href="#运行之前打印命令" class="headerlink" title="运行之前打印命令"></a>运行之前打印命令</h3><p><code>parallel</code>使用<code>--verbose</code>参数来指定在运行命令之前先打印命令：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">parallel --verbose <span class="built_in">echo</span> &#123;&#125; ::: A B C</span><br><span class="line">  <span class="built_in">echo</span> A</span><br><span class="line">  <span class="built_in">echo</span> B</span><br><span class="line">  <span class="built_in">echo</span> C</span><br><span class="line">  A</span><br><span class="line">  B</span><br><span class="line">  C</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="任务运行日志"><a href="#任务运行日志" class="headerlink" title="任务运行日志"></a>任务运行日志</h3><p>使用<code>--joblog</code>参数能够<strong>生成各个任务的日志文件</strong>：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parallel的运行日志为/tmp/log</span></span><br><span class="line">parallel --joblog /tmp/<span class="built_in">log</span> <span class="built_in">exit</span>  ::: 1 2 3 0</span><br><span class="line">cat /tmp/<span class="built_in">log</span> </span><br><span class="line">  Seq Host    Starttime   JobRuntime  Send    Receive Exitval Signal  Command</span><br><span class="line">  1   :   1523950890.344       0.018  0   0   1   0   <span class="built_in">exit</span> 1</span><br><span class="line">  2   :   1523950890.350       0.014  0   0   2   0   <span class="built_in">exit</span> 2</span><br><span class="line">  3   :   1523950890.357       0.006  0   0   3   0   <span class="built_in">exit</span> 3</span><br><span class="line">  4   :   1523950890.363       0.006  0   0   0   0   <span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p></p><p><strong>运行失败任务</strong>处理：</p><ul><li>通过<code>--resume-failed</code>参数可以重新运行失败的任务;</li><li><code>--retry-failed</code>的作用与<code>--resume-failed</code>类似，只是<code>--resume-failed</code>从<strong>命令行</strong>读取失败任务，而<code>--retry-failed</code>则是从<strong>日志文件</strong>中读取失败任务：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从命令行读取失败任务</span></span><br><span class="line"><span class="comment"># 所以需要加载最开始的运行命令中</span></span><br><span class="line">parallel --resume-failed --joblog /tmp/<span class="built_in">log</span> <span class="built_in">exit</span>  ::: 1 2 3 0 0 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从日志文件读取失败任务</span></span><br><span class="line"><span class="comment"># 只用指定日志文件即可</span></span><br><span class="line">parallel --retry-failed --joblog /tmp/<span class="built_in">log</span></span><br></pre></td></tr></table></figure><hr><h3 id="终止任务"><a href="#终止任务" class="headerlink" title="终止任务"></a>终止任务</h3><p><code>parallel</code>支持<strong>在某一情况下</strong>（如第一个失败或成功时，或者20%任务失败时）终止任务，终止任务又有<strong>两种类型</strong>:</p><ul><li>其一为<strong>立即终止（通过<code>--halt now</code>指定）</strong>，<strong>杀死所有正在运行</strong>的任务并停止生成新的任务;</li><li>其二为<strong>稍后终止（通过<code>--halt soon</code>指定）</strong>，停止生成新任务并<strong>等待正在运行任务完成</strong>。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在遇到一个失败任务之后待正在运行的任务完成就终止</span></span><br><span class="line">parallel -j2 --halt soon,fail=1 <span class="built_in">echo</span> &#123;&#125;\; <span class="built_in">exit</span> &#123;&#125; ::: 0 0 1 2 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在遇到一个失败任务之后立即终止</span></span><br><span class="line">parallel -j2 --halt now,fail=1 <span class="built_in">echo</span> &#123;&#125;\; <span class="built_in">exit</span> &#123;&#125; ::: 0 0 1 2 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在失败任务数达到20%之后待正在运行的任务完成就终止</span></span><br><span class="line">parallel -j2 --halt soon,fail=20% <span class="built_in">echo</span> &#123;&#125;\; <span class="built_in">exit</span> &#123;&#125; ::: 0 1 2 3 4 5 6 7 8 9  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 在成功的任务数达到1之后立即终止</span></span><br><span class="line">parallel -j2 --halt now,success=1 <span class="built_in">echo</span> &#123;&#125;\; <span class="built_in">exit</span> &#123;&#125; ::: 1 2 3 0 4 5 6</span><br></pre></td></tr></table></figure><hr><h3 id="管道模式–pipe"><a href="#管道模式–pipe" class="headerlink" title="管道模式–pipe"></a>管道模式–pipe</h3><p>前面学习的所有内容基本都是<strong>传参数模式</strong>，也就是不管是从文件还是命令行获取输入，都会作为命令的参数；而使用<code>--pipe</code>模式之后则会将<strong>管道前面的内容作为标准输入传给后面的命令</strong>：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat my_large_log   |parallel --pipe grep pattern</span><br></pre></td></tr></table></figure><p></p><p>如果不加 <code>--pipe</code> ，相当于 <code>my_large_log</code>中的<strong>每一行</strong>都变成 <code>grep pattern line</code>的命令展开了；而加入了<code>--pipe</code>，则和 <code>cat my_large_log | grep pattern</code> 没有区别，只是分配到各个核上去执行了。</p><p>具体的，<code>--pipe</code>参数会<strong>将输入(stdin)分为多个block</strong>，然后<strong>分配给多个核运行</strong>，具体的过程：</p><blockquote><p>command_A | command_B. By default GNU parallel will start an instance of command_B, read a chunk of 1 MB, and pass that to the instance. Then start another instance, read another chunk, and pass that to the second instance.</p></blockquote><p>可以使用<code>--block</code>参数可以指定每块的大小，<strong>默认为1M(The size of the chunk is not exactly 1 MB because GNU parallel only passes full lines - never half a line, thus the blocksize is only 1 MB on average.)</strong>:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 并行计算文件行数</span></span><br><span class="line">cat num30000 | parallel --pipe wc -l</span><br><span class="line">  30000 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置block大小为100k</span></span><br><span class="line">cat num30000 | parallel --block 100k  --pipe wc -l </span><br><span class="line">  18517</span><br><span class="line">  11483</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用原始方法计算</span></span><br><span class="line">wc -l num30000</span><br><span class="line">  30000 num30000</span><br></pre></td></tr></table></figure><p></p><p>如果<strong>输出结果的顺序不重要</strong>，可以使用<code>--roundrobin</code>参数，并且结合<code>--jobs</code>参数指定任务，那么所有的block就会在指定的任务数中执行，某个提前运行完了就会接着运行下一个(或者一部分)，这样更加均衡；如果不加<code>--roundrobin</code>参数，每个block都会开启一个任务，不会管均衡不均衡。</p><hr><p><br></p><h2 id="parallel相关实战"><a href="#parallel相关实战" class="headerlink" title="parallel相关实战"></a>parallel相关实战</h2><h3 id="改写for循环"><a href="#改写for循环" class="headerlink" title="改写for循环"></a>改写for循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原始的for循环</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> *jpeg</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">  convert <span class="variable">$i</span> <span class="variable">$i</span>.png </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改写后的命令行</span></span><br><span class="line"><span class="comment"># --max-args表示每次读取的参数个数，使用-N2也是一样的效果</span></span><br><span class="line"><span class="comment"># -I修改了占位符</span></span><br><span class="line">find . -name <span class="string">"*jpeg"</span> | parallel -I % --max-args 1 convert % %.png</span><br></pre></td></tr></table></figure><h3 id="一次传入多个参数"><a href="#一次传入多个参数" class="headerlink" title="一次传入多个参数"></a>一次传入多个参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意需要将&gt;使用引号括起来，不然得到的结果是所有的文件保存到了&#123;1&#125;_&#123;2&#125;.person中</span></span><br><span class="line">ls -1 | parallel --max-args=2 cat &#123;1&#125; &#123;2&#125; <span class="string">"&gt;"</span> &#123;1&#125;_&#123;2&#125;.person</span><br><span class="line"><span class="comment"># 使用-N2也是一样的效果</span></span><br><span class="line">ls -1 | parallel -N2 cat &#123;1&#125; &#123;2&#125; <span class="string">"&gt;"</span> &#123;1&#125;_&#123;2&#125;.png</span><br></pre></td></tr></table></figure><hr><h3 id="负载管理"><a href="#负载管理" class="headerlink" title="负载管理"></a>负载管理</h3><p>关于<a href="https://www.cnblogs.com/muahao/p/6492665.html" target="_blank" rel="noopener">cpu负载</a>：</p><blockquote><p>单核单CPU：如果CPU每分钟最多处理100个进程，那么系统负荷0.2，意味着CPU在这1分钟里只处理20个进程；系统负荷1.0，意味着CPU在这1分钟里正好处理100个进程；系统负荷1.7，意味着除了CPU正在处理的100个进程以外，还有70个进程正排队等着CPU处理。<br>单核多CPU：2个CPU，意味着电脑的处理能力翻了一倍，能够同时处理的进程数量也翻了一倍；所以，2个CPU表明系统负荷可以达到2.0，此时每个CPU都达到100%的工作量。推广开来，n个CPU的电脑，可接受的系统负荷最大为n.0。<br>多CPU多核：在系统负荷方面，多核CPU与多CPU效果类似，所以考虑系统负荷的时候，必须考虑这台电脑有几个CPU、每个CPU有几个核心。然后，把系统负荷除以总的核心数，只要每个核心的负荷不超过1.0，就表明电脑正常运行。</p></blockquote><p>使用实例：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">parallel --eta -j 2 --load 80% --noswap \</span><br><span class="line">  <span class="string">'blastp -db pdb_blast_db_example/pdb_seqres.txt -query &#123;&#125; \</span></span><br><span class="line"><span class="string">  -out blastp_outfiles/&#123;.&#125;.out -evalue 0.0001 -word_size 7 -outfmt "6 std stitle staxids sscinames" \</span></span><br><span class="line"><span class="string">  -max_target_seqs 10 -num_threads 1'</span> \</span><br><span class="line">  ::: test_seq*.fas</span><br></pre></td></tr></table></figure><p></p><p>其中：</p><ul><li><code>--eta</code>：显示任务完成的预计剩余时间；</li><li><code>-j 2</code>或<code>-jobs 2</code>：同时运行的命令数，在本例中设置为2；</li><li><code>--load 80%</code>：<strong>最大cpu负载</strong>；在上面的命令中，我们指定最多可以运行80％的CPU</li><li><code>--noswap</code>：如果服务器处于大量<strong>内存负载</strong>下，则<strong>不会启动新作业</strong>，以便在存储新信息之前从内存中删除信息。</li></ul><p>其他：</p><ul><li><code>--memfree 1G</code>：内存只有内存满足时才启动任务，Additionally, GNU parallel will kill off the <strong>youngest job if the memory free falls below 50% of the size</strong>. The killed job will put back on the queue and retried later.</li></ul><hr><h3 id="对脚本进行parallel"><a href="#对脚本进行parallel" class="headerlink" title="对脚本进行parallel"></a>对脚本进行parallel</h3><p>创建<code>python</code>脚本：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"the input num of arguments is \t:%s"</span> %str(len(sys.argv)))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sys.argv:</span><br><span class="line">    <span class="keyword">print</span> (i)</span><br></pre></td></tr></table></figure><p></p><p>运行<code>parallel</code>：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">parallel python parallel.py ::: a b c d e</span><br><span class="line">  <span class="comment"># 发现每次输出的参数格式都是2，说明是并行运行的，不是串行的</span></span><br><span class="line">  the input num of arguments is   :2</span><br><span class="line">  parallel.py</span><br><span class="line">  d</span><br><span class="line">  the input num of arguments is   :2</span><br><span class="line">  parallel.py</span><br><span class="line">  a</span><br><span class="line">  the input num of arguments is   :2</span><br><span class="line">  parallel.py</span><br><span class="line">  b</span><br><span class="line">  the input num of arguments is   :2</span><br><span class="line">  parallel.py</span><br><span class="line">  c</span><br><span class="line">  the input num of arguments is   :2</span><br><span class="line">  parallel.py</span><br><span class="line">  e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接运行python</span></span><br><span class="line">python parallel.py a b c d e</span><br><span class="line">  the input num of arguments is   :6</span><br><span class="line">  parallel.py</span><br><span class="line">  a</span><br><span class="line">  b</span><br><span class="line">  c</span><br><span class="line">  d</span><br><span class="line">  e</span><br></pre></td></tr></table></figure><p></p><hr><p><br></p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul><li><a href="https://www.gnu.org/software/parallel/parallel_tutorial.html" target="_blank" rel="noopener">官方文档</a></li><li><a href="https://www.youtube.com/watch?v=OpaiGYxkSuQ&amp;list=PL284C9FF2488BC6D1" target="_blank" rel="noopener">官方操作视频</a></li><li><a href="https://linux.cn/article-9718-1.html" target="_blank" rel="noopener">使用 GNU Parallel 提高 Linux 命令行执行效率</a></li><li><a href="http://blog.sciencenet.cn/blog-3353749-1130387.html" target="_blank" rel="noopener">强大的并行工具 GNU Parallel</a></li><li><a href="https://www.jianshu.com/p/cc54a72616a1" target="_blank" rel="noopener">Linux下的并行神器——parallel</a></li></ul><p><br></p><hr></div><div><div class="article_TheEnd">-----本文结束<i class="fa fa-paw"></i>感谢您的阅读-----</div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/posts/25074.html">Linux系列之parallel-并行化工具</a></p><p><span>文章作者:</span><a href="/" title="访问 showteeth 的个人博客">showteeth</a></p><p><span>发布时间:</span>2019年08月18日 - 17:36</p><p><span>最后更新:</span>2019年08月24日 - 16:06</p><p><span>原始链接:</span><a href="/posts/25074.html" title="Linux系列之parallel-并行化工具">http://showteeth.tech/posts/25074.html</a> <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://showteeth.tech/posts/25074.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><footer class="post-footer"><div class="post-tags"><a href="/tags/常用基本命令/" rel="tag"><i class="fa fa-tag"></i> 常用基本命令</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/11103.html" rel="next" title="Mac远程连接Windows"><i class="fa fa-chevron-left"></i> Mac远程连接Windows</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/posts/5793.html" rel="prev" title="Linux系列之grep进阶">Linux系列之grep进阶 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><script>window._bd_share_config={common:{bdText:"",bdMini:"1",bdMiniList:!1,bdPic:""},image:{viewList:["tsina","douban","sqq","qzone","weixin","twi","fbook"],viewText:"分享到：",viewSize:"16"},slide:{bdImg:"5",bdPos:"left",bdTop:"100"}}</script><script>with(document)(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="//bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5)</script></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/timg.jfif" alt="showteeth"><p class="site-author-name" itemprop="name">showteeth</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">168</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">37</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/showteeth" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://example.com/" title="hexo" target="_blank">hexo</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#parallel介绍"><span class="nav-number">1.</span> <span class="nav-text">parallel介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装parallel"><span class="nav-number">2.</span> <span class="nav-text">安装parallel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#parallel命令格式"><span class="nav-number">3.</span> <span class="nav-text">parallel命令格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#parallel使用示例"><span class="nav-number">4.</span> <span class="nav-text">parallel使用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数输入方式"><span class="nav-number">4.1.</span> <span class="nav-text">参数输入方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#命令行输入"><span class="nav-number">4.1.1.</span> <span class="nav-text">命令行输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#管道输入"><span class="nav-number">4.1.2.</span> <span class="nav-text">管道输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#文件输入"><span class="nav-number">4.1.3.</span> <span class="nav-text">文件输入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组合输入的信息"><span class="nav-number">4.2.</span> <span class="nav-text">组合输入的信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#命令行输入-1"><span class="nav-number">4.2.1.</span> <span class="nav-text">命令行输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#文件输入-1"><span class="nav-number">4.2.2.</span> <span class="nav-text">文件输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#混合输入"><span class="nav-number">4.2.3.</span> <span class="nav-text">混合输入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#取消输入的组合"><span class="nav-number">4.3.</span> <span class="nav-text">取消输入的组合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#指定参数分隔符"><span class="nav-number">4.4.</span> <span class="nav-text">指定参数分隔符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#指定参数定界符"><span class="nav-number">4.5.</span> <span class="nav-text">指定参数定界符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#指定参数结束值"><span class="nav-number">4.6.</span> <span class="nav-text">指定参数结束值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#跳过空行"><span class="nav-number">4.7.</span> <span class="nav-text">跳过空行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对输入参数进行替换"><span class="nav-number">4.8.</span> <span class="nav-text">对输入参数进行替换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#指定输入源输出顺序"><span class="nav-number">4.9.</span> <span class="nav-text">指定输入源输出顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#指定参数名和参数"><span class="nav-number">4.10.</span> <span class="nav-text">指定参数名和参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#背景文本"><span class="nav-number">4.11.</span> <span class="nav-text">背景文本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#限制每次读取的参数个数"><span class="nav-number">4.12.</span> <span class="nav-text">限制每次读取的参数个数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#去除输入参数的空格"><span class="nav-number">4.13.</span> <span class="nav-text">去除输入参数的空格</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加输出前缀"><span class="nav-number">4.14.</span> <span class="nav-text">添加输出前缀</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行之前打印命令"><span class="nav-number">4.15.</span> <span class="nav-text">运行之前打印命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#任务运行日志"><span class="nav-number">4.16.</span> <span class="nav-text">任务运行日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#终止任务"><span class="nav-number">4.17.</span> <span class="nav-text">终止任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#管道模式–pipe"><span class="nav-number">4.18.</span> <span class="nav-text">管道模式–pipe</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#parallel相关实战"><span class="nav-number">5.</span> <span class="nav-text">parallel相关实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#改写for循环"><span class="nav-number">5.1.</span> <span class="nav-text">改写for循环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一次传入多个参数"><span class="nav-number">5.2.</span> <span class="nav-text">一次传入多个参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#负载管理"><span class="nav-number">5.3.</span> <span class="nav-text">负载管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对脚本进行parallel"><span class="nav-number">5.4.</span> <span class="nav-text">对脚本进行parallel</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考链接"><span class="nav-number">6.</span> <span class="nav-text">参考链接</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-user-secret"></i> </span><span class="author" itemprop="copyrightHolder">showteeth</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">博客全站共&#58;</span> <span title="Site words total count">321.1k 字</span></div><div><span id="timeDate" title="网站运行时间">载入天数...</span><span id="times" title="网站运行时间">载入时分秒...</span></div><script>var now=new Date;function createtime(){var n=new Date("02/15/2019 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="————网站已运行"+dnum+"&thinsp;天",document.getElementById("times").innerHTML=hnum+"&thinsp;时"+mnum+"&thinsp;分"+snum+"&thinsp;秒————"}setInterval("createtime()",250)</script><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> 本站访客数 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次 </span><span class="site-pv"><i class="fa fa-eye"></i> 本站总访问量 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/photoswipe.min.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/photoswipe-ui-default.min.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'RVmtcwupIO6WlzPf3zKfb2EW-gzGzoHsz',
        appKey: 'E8jip4oe60SRcVTMAbhG9cyY',
        placeholder: '快来评论吧~',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });</script><script type="text/javascript">// Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });</script><script type="text/javascript" src="/js/src/clipboard.min.js"></script><script type="text/javascript" src="/js/src/clipboard-use.js"></script><script src="/js/src/photoswipe.min.js?v=5.1.4"></script><script src="/js/src/photoswipe-ui-default.min.js?v=5.1.4"></script></body></html>