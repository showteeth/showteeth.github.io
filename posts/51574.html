<!DOCTYPE html><html class="theme-next mist" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><script></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/dark_logo_180x180.jpg?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/dark_logo_32x32.jpg?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/dark_logo_16x16.jpg?v=5.1.4"><link rel="mask-icon" href="/images/dark_logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="常用模块,"><link rel="alternate" href="/atom.xml" title="showteeth's blog" type="application/atom+xml"><meta name="description" content="这篇文章主要学习了Python中用来进行高级文件操作的模块shutil，其主要包括文件或者目录的赋值、删除、剪切以及压缩和解压缩操作，是对上一个学习的os模块功能的补充。"><meta name="keywords" content="常用模块"><meta property="og:type" content="article"><meta property="og:title" content=" Python系列之shutil-高级文件操作"><meta property="og:url" content="http://showteeth.tech/posts/51574.html"><meta property="og:site_name" content="showteeth&#39;s blog"><meta property="og:description" content="这篇文章主要学习了Python中用来进行高级文件操作的模块shutil，其主要包括文件或者目录的赋值、删除、剪切以及压缩和解压缩操作，是对上一个学习的os模块功能的补充。"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-04-03T00:41:21.674Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content=" Python系列之shutil-高级文件操作"><meta name="twitter:description" content="这篇文章主要学习了Python中用来进行高级文件操作的模块shutil，其主要包括文件或者目录的赋值、删除、剪切以及压缩和解压缩操作，是对上一个学习的os模块功能的补充。"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://showteeth.tech/posts/51574.html"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/9d02ffb0.js","daovoice"),daovoice("init",{app_id:"9d02ffb0"}),daovoice("update")</script><title>Python系列之shutil-高级文件操作 | showteeth's blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><a href="https://github.com/showteeth" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">showteeth's blog</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-photos"><a href="/photos" rel="section"><i class="menu-item-icon fa fa-fw fa-camera"></i><br>相册</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://showteeth.tech/posts/51574.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="showteeth"><meta itemprop="description" content><meta itemprop="image" content="/images/timg.jfif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="showteeth's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Python系列之shutil-高级文件操作</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-01T08:11:24+08:00">2019-04-01 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2019-04-03T08:41:21+08:00">2019-04-03 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span> </a></span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python/常用模块/" itemprop="url" rel="index"><span itemprop="name">常用模块</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/posts/51574.html#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/posts/51574.html" itemprop="commentCount"></span> </a></span><span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-file-o"></i> 本文总阅读量 <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次</span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">4.2k 字 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">18 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><div class="note info"><p>这篇文章主要学习了Python中用来进行<strong>高级文件操作</strong>的模块<code>shutil</code>，其主要包括文件或者目录的<strong>赋值</strong>、<strong>删除</strong>、<strong>剪切</strong>以及<strong>压缩和解压缩操作</strong>，是对上一个学习的<a href="http://showteeth.tech/posts/24368.html">os模块</a>功能的补充。</p></div><a id="more"></a><h2 id="shutil简介"><a href="#shutil简介" class="headerlink" title="shutil简介"></a>shutil简介</h2><p>前面已经学习了<strong>os模块中的常用目录及文件操作</strong>，虽然其中有很多非常强大的功能，但是<strong>其中也有一些需要补足的地方</strong>，比如<strong>删除非空文件夹(这个是os模块不能直接做到的)、文件复制</strong>等，基于上述的补足，这里学习一下Python中高级文件操作的模块shutil，注意高级文件操作是Python官方给的名称，不是我直接编出来的，所以可见这个模块的强大。从主要功能上来看<strong>shutil模块是对os模块的补充</strong>，主要针对文件的<code>拷贝</code>、<code>删除</code>、<code>移动</code>、<code>压缩</code>和<code>解压</code>操作。</p><hr><h2 id="高级文件目录管理"><a href="#高级文件目录管理" class="headerlink" title="高级文件目录管理"></a>高级文件目录管理</h2><h3 id="复制文件内容到另一个文件"><a href="#复制文件内容到另一个文件" class="headerlink" title="复制文件内容到另一个文件"></a>复制文件内容到另一个文件</h3><p><strong>命令</strong>：<code>shutil.copyfileobj(fsrc, fdst[, length=16*1024])</code>，其中的<code>fsrc</code>和<code>fdst</code>都是<code>file-like object</code>(使用<code>open()</code>方法打开后的文件对象)。</p><p><strong>功能</strong>：copy文件内容(部分或全部)到另一个文件(<strong>从fsrc复制到fdst中</strong>)，<strong>可以copy指定大小的内容</strong>，默认的大小为<code>16*1024</code>；<strong>如果length设置为负值</strong>，则会<strong>读取整个文件内容</strong>，而不是以块的方式进行迭代读取；<mark>fdst文件是清空重写还是追加写入需要开文件的打开模式</mark></p><p><strong>程序的源码</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">copyfileobj</span><span class="params">(fsrc, fdst, length=<span class="number">16</span>*<span class="number">1024</span>)</span>:</span></span><br><span class="line">    <span class="string">"""copy data from file-like object fsrc to file-like object fdst"""</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># 程序的核心是这个read()</span></span><br><span class="line">        buf = fsrc.read(length)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> buf:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        fdst.write(buf)</span><br></pre></td></tr></table></figure><p></p><p>看了上述源码，发现很多问题就很简单了，包括从什么写入什么，read()参数的理解等等，所以说<strong>看源码才是王道啊</strong>！</p><p><strong>使用实例</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># source文件内容</span></span><br><span class="line">this <span class="keyword">is</span> source file!</span><br><span class="line"><span class="comment"># destination文件内容</span></span><br><span class="line">this <span class="keyword">is</span> destination file!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="comment"># source文件使用mode r读取打开</span></span><br><span class="line">s =open(<span class="string">'source.txt'</span>,<span class="string">'r'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># destination文件使用mode w写入打开</span></span><br><span class="line"><span class="comment"># w模式打开会清空文件内容</span></span><br><span class="line"><span class="comment"># 如果需要写入文件，可以使用a模式打开</span></span><br><span class="line">d=open(<span class="string">'target.txt'</span>,<span class="string">'w'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行复制操作，从source文件复制到destination文件</span></span><br><span class="line">shutil.copyfileobj(s,d,length=<span class="number">16</span>*<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到的destination文件内容</span></span><br><span class="line"><span class="comment"># 由于前面使用了w模式打开文件，所以文件内容被清空了</span></span><br><span class="line">this <span class="keyword">is</span> source file!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用追加模式打开destination文件</span></span><br><span class="line">d=open(<span class="string">'target.txt'</span>,<span class="string">'a'</span>)</span><br><span class="line">shutil.copyfileobj(s,d,length=<span class="number">16</span>*<span class="number">1024</span>)</span><br><span class="line"><span class="comment"># 得到的destination文件内容</span></span><br><span class="line"><span class="comment"># 由于前面使用了a模式打开文件，所以source文件内容是追加在后面</span></span><br><span class="line">this <span class="keyword">is</span> target file!</span><br><span class="line">this <span class="keyword">is</span> source file!</span><br></pre></td></tr></table></figure><p></p><div class="note info"><ul><li><strong>部分或者全部复制</strong>：Note that if the <strong>current file position of the fsrc object is not 0</strong>, <strong>only the contents from the current file position to the end of the file will be copied</strong>.</li><li><code>fdst</code>文件是<strong>清空重写(w模式)</strong>还是<strong>追加写入(a模式)</strong>需要开文件的打开模式</li></ul></div><hr><h3 id="复制整个文件内容到另一个文件"><a href="#复制整个文件内容到另一个文件" class="headerlink" title="复制整个文件内容到另一个文件"></a>复制整个文件内容到另一个文件</h3><p><strong>命令</strong>：<code>shutil.copyfile(src, dst)</code>，和上一个命令比较相似，<strong>不同于上一个命令的是src和dst是字符串形式的文件路径而不是文件对象</strong>，也就是说使用之前不用open()。</p><p><strong>功能</strong>：拷贝整个文件(src)内容到另一个文件(dst)；如果source文件和destination<strong>文件是相同</strong>的，则会<strong>产生错误</strong>，同时<strong>destination文件必须是可写</strong>的，<strong>不然也会报错</strong>；同时<mark>需要注意如果目标文件destination中有内容，执行操作后会覆盖</mark>。</p><p><strong>源码</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">copyfile</span><span class="params">(src, dst, *, follow_symlinks=True)</span>:</span></span><br><span class="line">    <span class="string">"""Copy data from src to dst.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If follow_symlinks is not set and src is a symbolic link, a new</span></span><br><span class="line"><span class="string">    symlink will be created instead of copying the file it points to.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 判断文件是否相同，如果相同就报错</span></span><br><span class="line">    <span class="keyword">if</span> _samefile(src, dst):</span><br><span class="line">        <span class="keyword">raise</span> SameFileError(<span class="string">"&#123;!r&#125; and &#123;!r&#125; are the same file"</span>.format(src, dst))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> fn <span class="keyword">in</span> [src, dst]:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            st = os.stat(fn)</span><br><span class="line">        <span class="keyword">except</span> OSError:</span><br><span class="line">            <span class="comment"># File most likely does not exist</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># XXX What about other special files? (sockets, devices...)</span></span><br><span class="line">            <span class="keyword">if</span> stat.S_ISFIFO(st.st_mode):</span><br><span class="line">                <span class="keyword">raise</span> SpecialFileError(<span class="string">"`%s` is a named pipe"</span> % fn)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> follow_symlinks <span class="keyword">and</span> os.path.islink(src):</span><br><span class="line">        os.symlink(os.readlink(src), dst)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">with</span> open(src, <span class="string">'rb'</span>) <span class="keyword">as</span> fsrc:</span><br><span class="line">            <span class="comment"># 这里的打开模式需要注意，会清空原始的target的文件内容</span></span><br><span class="line">            <span class="keyword">with</span> open(dst, <span class="string">'wb'</span>) <span class="keyword">as</span> fdst:</span><br><span class="line">                <span class="comment"># 调用了前面提到的shutil.copyfileobj</span></span><br><span class="line">                copyfileobj(fsrc, fdst)</span><br><span class="line">    <span class="keyword">return</span> dst</span><br></pre></td></tr></table></figure><p></p><p><strong>使用实例</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># source文件内容</span></span><br><span class="line">this <span class="keyword">is</span> source file!</span><br><span class="line"><span class="comment"># destination文件内容</span></span><br><span class="line">this <span class="keyword">is</span> destination file!</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># 先修改工作目录</span></span><br><span class="line">os.chdir(<span class="string">r"c:\FastFolder\learn_test"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行复制操作，从source文件复制到destination文件</span></span><br><span class="line">shutil.copyfile(<span class="string">'source.txt'</span>,<span class="string">'target.txt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到的destination文件内容</span></span><br><span class="line"><span class="comment"># 可见原始的文件内容被清空了</span></span><br><span class="line">this <span class="keyword">is</span> source file!</span><br></pre></td></tr></table></figure><p></p><div class="note info"><ul><li><strong>全部复制</strong>，<strong>目标文件的原有内容会被清空</strong>，可以从源码中文件的打开模式看出</li><li><strong>传递的是表示文件地址的字符串</strong>，而不是像前面的<code>shutil.copyfileobj(fsrc, fdst[, length=16*1024])</code>传递的是文件对象</li></ul></div><hr><h3 id="仅复制权限"><a href="#仅复制权限" class="headerlink" title="仅复制权限"></a>仅复制权限</h3><p><strong>命令</strong>：<code>shutil.copymode(src, dst)</code>：<strong>仅拷贝权限</strong>，内容、组、用户均不变；<strong>src和dst是字符串形式的文件路径而不是文件对象</strong></p><hr><h3 id="仅复制状态信息"><a href="#仅复制状态信息" class="headerlink" title="仅复制状态信息"></a>仅复制状态信息</h3><p><strong>命令</strong>：<code>shutil.copystat(src, dst)</code>：<strong>仅复制所有的状态信息，包括权限，组，用户，修改时间等</strong>；<strong>src和dst是字符串形式的文件路径而不是文件对象</strong></p><h3 id="复制文件内容和权限"><a href="#复制文件内容和权限" class="headerlink" title="复制文件内容和权限"></a>复制文件内容和权限</h3><p><strong>命令</strong>：<code>shutil.copy(src,dst)</code>：</p><ul><li><strong>同时复制文件的内容以及权限</strong></li><li><strong>相当于先copyfile()然后copymode()</strong></li><li>如果<strong>dst是一个目录</strong>，一个和src文件的basename相同的文件会被创建(或重写)；</li><li><strong>src和dst是字符串形式的文件路径而不是文件对象</strong></li></ul><p><strong>源码</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">copy</span><span class="params">(src, dst, *, follow_symlinks=True)</span>:</span></span><br><span class="line">    <span class="string">"""Copy data and mode bits ("cp src dst"). Return the file's destination.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The destination may be a directory.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If follow_symlinks is false, symlinks won't be followed. This</span></span><br><span class="line"><span class="string">    resembles GNU's "cp -P src dst".</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If source and destination are the same file, a SameFileError will be</span></span><br><span class="line"><span class="string">    raised.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 判断，如果dst是一个目录，就使用src的basename创建文件</span></span><br><span class="line">    <span class="keyword">if</span> os.path.isdir(dst):</span><br><span class="line">        dst = os.path.join(dst, os.path.basename(src))</span><br><span class="line">    copyfile(src, dst, follow_symlinks=follow_symlinks)</span><br><span class="line">    copymode(src, dst, follow_symlinks=follow_symlinks)</span><br><span class="line">    <span class="keyword">return</span> dst</span><br></pre></td></tr></table></figure><p></p><p><strong>使用实例</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># 先修改工作目录</span></span><br><span class="line">os.chdir(<span class="string">r"c:\FastFolder\learn_test"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行复制操作，其中的dst为目录</span></span><br><span class="line">shutil.copy(<span class="string">'source.txt'</span>,<span class="string">'old_name'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在old_name目录下生成了source.txt文件，和src名称相同，而且内容也相同</span></span><br></pre></td></tr></table></figure><p></p><hr><h3 id="复制文件内容和状态"><a href="#复制文件内容和状态" class="headerlink" title="复制文件内容和状态"></a>复制文件内容和状态</h3><p><strong>命令</strong>：<code>shutil.copy2(src, dst)</code>：与copy函数功能大部分一致，<strong>只是会把所有的文件元数据()都复制(copymode-&gt;copystat)</strong>；同时<strong>复制文件的内容</strong>以及<strong>文件的所有状态信息</strong>；相当于先<code>copyfile()</code>后<code>copystat()</code>；元数据的复制是通过<code>shutil.copystat(src, dst)</code>来完成；</p><p><strong>补充(元数据的定义)</strong>：主要是<strong>描述数据属性(property)的信息</strong>，用来支持如指示存储位置、历史数据、资源查找、文件记录等功能，<strong>是一种数据的数据</strong>，更多关于元数据可以看<a href="https://www.cnblogs.com/XWShuai/p/5936531.html" target="_blank" rel="noopener">这篇文章</a>。</p><hr><h3 id="排除指定的文件"><a href="#排除指定的文件" class="headerlink" title="排除指定的文件"></a>排除指定的文件</h3><p><strong>命令</strong>：<code>shutil.ignore_patterns(*patterns)</code>：接收<strong>一个或多个通配符字符串</strong>，然后<strong>创建</strong>一个可以被<strong>传递给shutil.copytree()方法的’ignore’参数</strong>的<strong>函数</strong>；当文件名与指定的通配符匹配时，则不会被赋值，也就是<strong>排除指定的文件</strong>。</p><hr><h3 id="递归复制目录和子目录"><a href="#递归复制目录和子目录" class="headerlink" title="递归复制目录和子目录"></a>递归复制目录和子目录</h3><p><strong>命令</strong>：<code>shutil.copytree(src, dst, symlinks=False, ignore=None)</code>：</p><ul><li><strong>递归</strong>地复制<strong>src目录及其子目录</strong>的<strong>文件</strong>和<strong>状态信息</strong>到目标<strong>目录dst</strong></li><li><strong>目标目录dst必须是不存在的</strong></li><li>如果目标目录的<strong>父目录不存在</strong>，则会<strong>一同创建</strong></li><li>目录的<strong>权限和时间</strong>通过<code>shutil.copystat()</code>来拷贝，<strong>单个文件</strong>通过<code>shutil.copy2()</code>来拷贝</li></ul><p><strong>参数</strong>：</p><ul><li><strong><code>symlinks</code>参数</strong>：指定是否复制软链接(小心陷入死循环)，<strong>如果为true</strong>，则以链接的形式进行复制；<strong>如果为false或者默认情况下</strong>，则会将链接文件的内容进行复制</li><li><strong><code>ignore</code>参数</strong>：指定<strong>不参与复制的文件</strong>，其值应该是一个<code>ignore_patterns()</code>方法；也是<strong>递归的ignore</strong>，每个目录下的符合ignore的都会被忽略，因为这个参数是传递给<code>copytree</code>的，而<code>copytree</code>是递归调用的</li></ul><p><strong>源码</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">copytree</span><span class="params">(src, dst, symlinks=False, ignore=None, copy_function=copy2,</span></span></span><br><span class="line"><span class="function"><span class="params">             ignore_dangling_symlinks=False)</span>:</span></span><br><span class="line">    <span class="string">"""Recursively copy a directory tree.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The destination directory must not already exist.</span></span><br><span class="line"><span class="string">    If exception(s) occur, an Error is raised with a list of reasons.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If the optional symlinks flag is true, symbolic links in the</span></span><br><span class="line"><span class="string">    source tree result in symbolic links in the destination tree; if</span></span><br><span class="line"><span class="string">    it is false, the contents of the files pointed to by symbolic</span></span><br><span class="line"><span class="string">    links are copied. If the file pointed by the symlink doesn't</span></span><br><span class="line"><span class="string">    exist, an exception will be added in the list of errors raised in</span></span><br><span class="line"><span class="string">    an Error exception at the end of the copy process.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    You can set the optional ignore_dangling_symlinks flag to true if you</span></span><br><span class="line"><span class="string">    want to silence this exception. Notice that this has no effect on</span></span><br><span class="line"><span class="string">    platforms that don't support os.symlink.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The optional ignore argument is a callable. If given, it</span></span><br><span class="line"><span class="string">    is called with the `src` parameter, which is the directory</span></span><br><span class="line"><span class="string">    being visited by copytree(), and `names` which is the list of</span></span><br><span class="line"><span class="string">    `src` contents, as returned by os.listdir():</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        callable(src, names) -&gt; ignored_names</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Since copytree() is called recursively, the callable will be</span></span><br><span class="line"><span class="string">    called once for each directory that is copied. It returns a</span></span><br><span class="line"><span class="string">    list of names relative to the `src` directory that should</span></span><br><span class="line"><span class="string">    not be copied.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The optional copy_function argument is a callable that will be used</span></span><br><span class="line"><span class="string">    to copy each file. It will be called with the source path and the</span></span><br><span class="line"><span class="string">    destination path as arguments. By default, copy2() is used, but any</span></span><br><span class="line"><span class="string">    function that supports the same signature (like copy()) can be used.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># names中存储了目录所有文件的列表---不能区分文件或者目录</span></span><br><span class="line">    names = os.listdir(src)</span><br><span class="line">    <span class="keyword">if</span> ignore <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        ignored_names = ignore(src, names)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ignored_names = set()</span><br><span class="line">    <span class="comment"># 这里是os.makedirs，所以是递归创建目录的，也就是可以创建父目录</span></span><br><span class="line">    os.makedirs(dst)</span><br><span class="line">    errors = []</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">        <span class="comment"># 判断是不是复制ignore的条件，符合就直接进行下一轮循环</span></span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">in</span> ignored_names:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        srcname = os.path.join(src, name)</span><br><span class="line">        dstname = os.path.join(dst, name)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> os.path.islink(srcname):</span><br><span class="line">                linkto = os.readlink(srcname)</span><br><span class="line">                <span class="comment"># 函数传递的参数</span></span><br><span class="line">                <span class="keyword">if</span> symlinks:</span><br><span class="line">                    <span class="comment"># We can't just leave it to `copy_function` because legacy</span></span><br><span class="line">                    <span class="comment"># code with a custom `copy_function` may rely on copytree</span></span><br><span class="line">                    <span class="comment"># doing the right thing.</span></span><br><span class="line">                    os.symlink(linkto, dstname)</span><br><span class="line">                    copystat(srcname, dstname, follow_symlinks=<span class="keyword">not</span> symlinks)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># ignore dangling symlink if the flag is on</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(linkto) <span class="keyword">and</span> ignore_dangling_symlinks:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    <span class="comment"># otherwise let the copy occurs. copy2 will raise an error</span></span><br><span class="line">                    <span class="keyword">if</span> os.path.isdir(srcname):</span><br><span class="line">                        <span class="comment"># 这部分是递归复制</span></span><br><span class="line">                        copytree(srcname, dstname, symlinks, ignore,</span><br><span class="line">                                 copy_function)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        copy_function(srcname, dstname)</span><br><span class="line">            <span class="keyword">elif</span> os.path.isdir(srcname):</span><br><span class="line">                copytree(srcname, dstname, symlinks, ignore, copy_function)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># Will raise a SpecialFileError for unsupported file types</span></span><br><span class="line">                copy_function(srcname, dstname)</span><br><span class="line">        <span class="comment"># catch the Error from the recursive copytree so that we can</span></span><br><span class="line">        <span class="comment"># continue with other files</span></span><br><span class="line">        <span class="keyword">except</span> Error <span class="keyword">as</span> err:</span><br><span class="line">            errors.extend(err.args[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">except</span> OSError <span class="keyword">as</span> why:</span><br><span class="line">            errors.append((srcname, dstname, str(why)))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        copystat(src, dst)</span><br><span class="line">    <span class="keyword">except</span> OSError <span class="keyword">as</span> why:</span><br><span class="line">        <span class="comment"># Copying file access times may fail on Windows</span></span><br><span class="line">        <span class="keyword">if</span> getattr(why, <span class="string">'winerror'</span>, <span class="keyword">None</span>) <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            errors.append((src, dst, str(why)))</span><br><span class="line">    <span class="keyword">if</span> errors:</span><br><span class="line">        <span class="keyword">raise</span> Error(errors)</span><br><span class="line">    <span class="keyword">return</span> dst</span><br></pre></td></tr></table></figure><p></p><p><strong>使用实例</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> shutil <span class="keyword">import</span> copytree, ignore_patterns</span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略pyc文件和tmp文件</span></span><br><span class="line"><span class="comment"># 注意destination肯定是不存在的</span></span><br><span class="line">copytree(source, destination, ignore=ignore_patterns(<span class="string">'*.pyc'</span>, <span class="string">'tmp*'</span>))</span><br><span class="line">copytree(<span class="string">'folder1'</span>, <span class="string">'folder2'</span>, ignore=ignore_patterns(<span class="string">'*.pyc'</span>, <span class="string">'tmp*'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制链接，不是复制链接指向文件的内容</span></span><br><span class="line">copytree(<span class="string">'f1'</span>, <span class="string">'f2'</span>, symlinks=<span class="keyword">True</span>, ignore=ignore_patterns(<span class="string">'*.pyc'</span>, <span class="string">'tmp*'</span>))</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="递归删除"><a href="#递归删除" class="headerlink" title="递归删除"></a>递归删除</h3><p><strong>命令</strong>：<code>shutil.rmtree(path[, ignore_errors[, onerror]])</code>，<strong>递归地删除目录(path，不能为链接目录)及子目录内的文件</strong>。注意！该方法不会询问yes或no，被删除的文件也不会出现在回收站里，<strong>请务必小心</strong>！</p><p><strong>参数</strong>：</p><ul><li><strong><code>path</code></strong>：指定目录，但不能是链接指向的目录，传递的是<strong>字符串形式的文件路径而不是文件对象</strong></li><li><strong><code>ignore_errors</code></strong>：设置为true，删除过程中的出错不会被抛出，会被忽略；如果为false或者忽略这个参数，删除过程中的错误会调用onerror中的错误处理方式进行处理，如果<code>onerror</code>中没有定义处理方式，就会抛出错误。</li><li><strong>onerror</strong>：一旦提供这个参数，就必须有三个参数<code>function</code>、<code>path</code>和<code>excinfo</code>.<ul><li><code>function</code>：抛出异常的函数，是<code>os.path.islink()</code>、<code>os.listdir()</code>、 <code>os.remove()</code>或者<code>os.rmdir()</code></li><li><code>path</code>：传递给function参数的path名</li><li><code>excinfo</code>：<code>sys.exc_info()</code>返回的异常信息</li><li><code>onerror</code>的异常不会被捕获</li></ul></li></ul><p><strong>使用实例</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, stat</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_readonly</span><span class="params">(func, path, _)</span>:</span></span><br><span class="line">    <span class="comment"># 去除文件的只读属性，尝试再次删除</span></span><br><span class="line">    os.chmod(path, stat.S_IWRITE)</span><br><span class="line">    <span class="comment"># 这里的func是针对前面抛出异常的操作</span></span><br><span class="line">    func(path)</span><br><span class="line"></span><br><span class="line">shutil.rmtree(directory, onerror=remove_readonly)</span><br></pre></td></tr></table></figure><p></p><div class="note info"><p><strong>需要注意的方面</strong>：<br><strong>删除路径的最后一个目录，而不是整个路径</strong>，例如<code>shutil.rmtree(&#39;user/tester/noob&#39;)</code>只会删除最后的<code>noob</code>目录的所有内容，而不会将整个路径<code>&#39;user/tester/noob&#39;</code>包含的文件夹都删除，参考<a href="https://stackoverflow.com/questions/10873364/shutil-rmtree-clarification" target="_blank" rel="noopener">这个链接</a>。</p></div><hr><h3 id="剪切目录"><a href="#剪切目录" class="headerlink" title="剪切目录"></a>剪切目录</h3><p><strong>命令</strong>：<code>shutil.move(src, dst)</code>，递归地移动文件或者目录，类似<code>mv</code>命令；如果destination是一个已经存在的目录，src会直接移动到这个目录中；如果destination已经存在但不是一个目录，destination将会被重写；如果是同一个文件或者目录，重命名。</p><hr><h3 id="查找文件路径"><a href="#查找文件路径" class="headerlink" title="查找文件路径"></a>查找文件路径</h3><p><strong>命令</strong>：<code>which(cmd, mode=os.F_OK | os.X_OK, path=None)</code>，返回文件路径，类似Linux的<code>which</code>命令</p><p><strong>参数讲解</strong>：</p><ul><li><strong><code>cmd</code></strong>：需要查找的内容-字符串形式</li><li><strong><code>mode</code></strong>：查找内容的权限，默认情况<code>os.F_OK</code>：path是否存在以及<code>os.X_OK</code>：path是否可执行</li><li><strong><code>path</code></strong>：在指定路径中查找</li></ul><p><strong>使用场景</strong>：典型的使用场景是在环境变量 <code>PATH</code> 定义的路径中查找<strong>可执行程序</strong>的位置，如果<strong>没有找到文件</strong>，<code>which()</code> 返回 <code>None</code></p><hr><p><br></p><h2 id="归档操作"><a href="#归档操作" class="headerlink" title="归档操作"></a>归档操作</h2><h3 id="查看支持的压缩文件格式"><a href="#查看支持的压缩文件格式" class="headerlink" title="查看支持的压缩文件格式"></a>查看支持的压缩文件格式</h3><p><strong>命令</strong>：<code>shutil.get_archive_formats()</code></p><p><strong>使用实例</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> format, description <span class="keyword">in</span> shutil.get_archive_formats():</span><br><span class="line">    print(<span class="string">'&#123;:&lt;5&#125;: &#123;&#125;'</span>.format(format, description))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">    bztar: bzip2<span class="string">'ed tar-file</span></span><br><span class="line"><span class="string">    gztar: gzip'</span>ed tar-file</span><br><span class="line">    tar  : uncompressed tar file</span><br><span class="line">    xztar: xz<span class="string">'ed tar-file</span></span><br><span class="line"><span class="string">    zip  : ZIP file</span></span><br></pre></td></tr></table></figure><p></p><hr><h3 id="创建归档或压缩文件"><a href="#创建归档或压缩文件" class="headerlink" title="创建归档或压缩文件"></a>创建归档或压缩文件</h3><p><strong>命令</strong>：<code>shutil.make_archive(base_name, format[, root_dir[, base_dir[, verbose[, dry_run[, owner[, group[, logger]]]]]]])</code></p><p><strong>参数说明</strong>：</p><ul><li><strong><code>base_name</code></strong>：<strong>压缩后的文件名(不包含拓展名)</strong>；如果不指定绝对路径，则压缩文件保存在当前目录下；<strong>这个参数必须指定</strong></li><li><strong><code>format</code></strong>：<strong>压缩格式</strong>，可以是<code>zip</code>、<code>tar</code>、<code>bztar(tar.bz2)</code>、<code>gztar(tar.gz)</code>、<code>xztar</code>中的一种；<strong>这个参数也必须指定</strong></li><li><strong><code>root_dir</code></strong>：<strong>设置压缩包里的根目录</strong>，即在创建归档之前先切换到它指定的目录，一般使用默认值，不特别指定</li><li><strong><code>base_dir</code></strong>：要<strong>进行压缩的源文件或目录</strong>，如果<strong>没有提供</strong>则<strong>对root_dir目录下的所有文件进行归档压缩</strong></li><li><strong><code>dry_run</code></strong>：如果值为Ture表示不会创建归档，但是操作输出会被记录到logger中，<strong>可用于测试</strong></li><li><strong><code>owner</code></strong>：<strong>用户</strong>，默认当前用户</li><li><strong><code>group</code></strong>：<strong>组</strong>，默认当前组</li><li><strong><code>logger</code></strong>：用于<strong>记录日志</strong>，通常是logging.Logger对象</li></ul><p><strong>使用实例</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提供base_dir</span></span><br><span class="line">shutil.make_archive(base_name=<span class="string">"test"</span>, format=<span class="string">"gztar"</span>,  base_dir=<span class="string">"./cat"</span>)</span><br><span class="line">    <span class="comment"># 返回</span></span><br><span class="line">    <span class="string">'test.tar.gz'</span></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line"><span class="comment"># 注意文件中显示的路径，如果前面设置的是全路径，会创建全路径的文件夹</span></span><br><span class="line">    drwxrwxr-x user/user     <span class="number">0</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">18</span>:<span class="number">29</span> ./cat/</span><br><span class="line">    -rw-rw-r-- user/user    <span class="number">13</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">17</span>:<span class="number">28</span> ./cat/test1.txt</span><br><span class="line">    -rw-rw-r-- user/user     <span class="number">7</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">18</span>:<span class="number">05</span> ./cat/test2.txt</span><br><span class="line">    -rw-rw-r-- user/user    <span class="number">20</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">18</span>:<span class="number">05</span> ./cat/test3.txt</span><br><span class="line">    -rw-rw-r-- user/user     <span class="number">8</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">18</span>:<span class="number">14</span> ./cat/filename</span><br><span class="line">    -rw-rw-r-- user/user     <span class="number">8</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">18</span>:<span class="number">29</span> ./cat/test4.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果只提供root_dir</span></span><br><span class="line">shutil.make_archive(base_name=<span class="string">"test2"</span>, format=<span class="string">"gztar"</span>,  root_dir=<span class="string">"./cat"</span>)</span><br><span class="line">    <span class="comment"># 返回</span></span><br><span class="line">    <span class="string">'absolute_path/test2.tar.gz'</span></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">    drwxrwxr-x user/user     <span class="number">0</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">18</span>:<span class="number">29</span> ./</span><br><span class="line">    -rw-rw-r-- user/user    <span class="number">13</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">17</span>:<span class="number">28</span> ./test1.txt</span><br><span class="line">    -rw-rw-r-- user/user     <span class="number">7</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">18</span>:<span class="number">05</span> ./test2.txt</span><br><span class="line">    -rw-rw-r-- user/user    <span class="number">20</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">18</span>:<span class="number">05</span> ./test3.txt</span><br><span class="line">    -rw-rw-r-- user/user     <span class="number">8</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">18</span>:<span class="number">14</span> ./filename</span><br><span class="line">    -rw-rw-r-- user/user     <span class="number">8</span> <span class="number">2019</span><span class="number">-03</span><span class="number">-22</span> <span class="number">18</span>:<span class="number">29</span> ./test4.txt</span><br></pre></td></tr></table></figure><p></p><div class="note info"><p><strong>设置<code>base_dir</code>之后</strong>会在压缩的文件中会出现设置的<code>base_dir</code>路径(<strong>保留了原始路径信息</strong>)，这个需要特别注意，如果设置的是全路径指向某一个文件，解压的结果中也会包含那个全路径；<strong>如果设置的是<code>root_dir</code>，不设置<code>base_dir</code></strong>，默认对<code>root_dir</code>中的进行压缩，则不会有上述麻烦，生成的文件解压后直接可以看到内容，<strong>不会出现全路径</strong>。</p></div><hr><h3 id="解压缩后缀与格式的对应"><a href="#解压缩后缀与格式的对应" class="headerlink" title="解压缩后缀与格式的对应"></a>解压缩后缀与格式的对应</h3><p><strong>命令</strong>：<code>shutil.get_unpack_formats()</code></p><p><strong>使用实例</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> format, exts, description <span class="keyword">in</span> shutil.get_unpack_formats():</span><br><span class="line">    print(<span class="string">'&#123;:&lt;5&#125;: &#123;&#125;, names ending in &#123;&#125;'</span>.format(</span><br><span class="line">        format, description, exts))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">    bztar: bzip2<span class="string">'ed tar-file, names ending in ['</span>.tar.bz2<span class="string">', '</span>.tbz2<span class="string">']</span></span><br><span class="line"><span class="string">    gztar: gzip'</span>ed tar-file, names ending <span class="keyword">in</span> [<span class="string">'.tar.gz'</span>, <span class="string">'.tgz'</span>]</span><br><span class="line">    tar  : uncompressed tar file, names ending <span class="keyword">in</span> [<span class="string">'.tar'</span>]</span><br><span class="line">    xztar: xz<span class="string">'ed tar-file, names ending in ['</span>.tar.xz<span class="string">', '</span>.txz<span class="string">']</span></span><br><span class="line"><span class="string">    zip  : ZIP file, names ending in ['</span>.zip<span class="string">']</span></span><br></pre></td></tr></table></figure><p></p><hr><h3 id="解压缩或解包源文件"><a href="#解压缩或解包源文件" class="headerlink" title="解压缩或解包源文件"></a>解压缩或解包源文件</h3><p><strong>命令</strong>：<code>shutil.unpack_archive(filename[, extract_dir[, format]])</code></p><p><strong>参数说明</strong>：</p><ul><li><strong><code>filename</code></strong>：是压缩文档的<strong>完整路径</strong></li><li><strong><code>extract_dir</code></strong>：是<strong>解压缩路径</strong>，默认为当前目录</li><li><strong><code>format</code></strong>：是<strong>压缩格式</strong>，<strong>默认使用文件后缀名代码的压缩格式</strong>，可以是<code>zip</code>、<code>tar</code>、<code>bztar(tar.bz2)</code>、<code>gztar(tar.gz)</code>、<code>xztar</code>中的一种；如果<strong>不提供这个参数</strong>，程序会<strong>根据filename的后缀名</strong>来自动选择方法。</li></ul><p><strong>使用实例</strong>：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="comment"># filename是全路径</span></span><br><span class="line">shutil.unpack_archive(<span class="string">"full_path/test.tar.gz"</span>, <span class="string">"./test"</span>, <span class="string">'gztar'</span>)</span><br></pre></td></tr></table></figure><p></p><hr><p><br></p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul><li><a href="http://www.liujiangblog.com/course/python/61" target="_blank" rel="noopener">shutil</a></li><li><a href="https://www.cnblogs.com/yyds/p/6427349.html" target="_blank" rel="noopener">Python之文件与目录操作（os、zipfile、tarfile、shutil）</a></li><li><a href="https://docs.python.org/3/library/shutil.html" target="_blank" rel="noopener">shutil — High-level file operations</a></li><li><a href="https://learnku.com/docs/pymotw/shutil-high-order-file-operation/3397" target="_blank" rel="noopener">实例教程</a></li></ul><p><br></p><hr></div><div><div class="article_TheEnd">-----本文结束<i class="fa fa-paw"></i>感谢您的阅读-----</div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/posts/51574.html"> Python系列之shutil-高级文件操作</a></p><p><span>文章作者:</span><a href="/" title="访问 showteeth 的个人博客">showteeth</a></p><p><span>发布时间:</span>2019年04月01日 - 08:11</p><p><span>最后更新:</span>2019年04月03日 - 08:41</p><p><span>原始链接:</span><a href="/posts/51574.html" title=" Python系列之shutil-高级文件操作">http://showteeth.tech/posts/51574.html</a> <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://showteeth.tech/posts/51574.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><footer class="post-footer"><div class="post-tags"><a href="/tags/常用模块/" rel="tag"><i class="fa fa-tag"></i> 常用模块</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/24368.html" rel="next" title="Python系列之os-使用操作系统相关功能"><i class="fa fa-chevron-left"></i> Python系列之os-使用操作系统相关功能</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/posts/24468.html" rel="prev" title="Python系列之glob-文件名规则匹配">Python系列之glob-文件名规则匹配 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><script>window._bd_share_config={common:{bdText:"",bdMini:"1",bdMiniList:!1,bdPic:""},image:{viewList:["tsina","douban","sqq","qzone","weixin","twi","fbook"],viewText:"分享到：",viewSize:"16"},slide:{bdImg:"5",bdPos:"left",bdTop:"100"}}</script><script>with(document)(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="//bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5)</script></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/timg.jfif" alt="showteeth"><p class="site-author-name" itemprop="name">showteeth</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">80</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">22</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">27</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/showteeth" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://example.com/" title="hexo" target="_blank">hexo</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#shutil简介"><span class="nav-number">1.</span> <span class="nav-text">shutil简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高级文件目录管理"><span class="nav-number">2.</span> <span class="nav-text">高级文件目录管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#复制文件内容到另一个文件"><span class="nav-number">2.1.</span> <span class="nav-text">复制文件内容到另一个文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复制整个文件内容到另一个文件"><span class="nav-number">2.2.</span> <span class="nav-text">复制整个文件内容到另一个文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#仅复制权限"><span class="nav-number">2.3.</span> <span class="nav-text">仅复制权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#仅复制状态信息"><span class="nav-number">2.4.</span> <span class="nav-text">仅复制状态信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复制文件内容和权限"><span class="nav-number">2.5.</span> <span class="nav-text">复制文件内容和权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复制文件内容和状态"><span class="nav-number">2.6.</span> <span class="nav-text">复制文件内容和状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#排除指定的文件"><span class="nav-number">2.7.</span> <span class="nav-text">排除指定的文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#递归复制目录和子目录"><span class="nav-number">2.8.</span> <span class="nav-text">递归复制目录和子目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#递归删除"><span class="nav-number">2.9.</span> <span class="nav-text">递归删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#剪切目录"><span class="nav-number">2.10.</span> <span class="nav-text">剪切目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查找文件路径"><span class="nav-number">2.11.</span> <span class="nav-text">查找文件路径</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#归档操作"><span class="nav-number">3.</span> <span class="nav-text">归档操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查看支持的压缩文件格式"><span class="nav-number">3.1.</span> <span class="nav-text">查看支持的压缩文件格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建归档或压缩文件"><span class="nav-number">3.2.</span> <span class="nav-text">创建归档或压缩文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解压缩后缀与格式的对应"><span class="nav-number">3.3.</span> <span class="nav-text">解压缩后缀与格式的对应</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解压缩或解包源文件"><span class="nav-number">3.4.</span> <span class="nav-text">解压缩或解包源文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考链接"><span class="nav-number">4.</span> <span class="nav-text">参考链接</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-user-secret"></i> </span><span class="author" itemprop="copyrightHolder">showteeth</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">博客全站共&#58;</span> <span title="Site words total count">174.4k 字</span></div><div><span id="timeDate" title="网站运行时间">载入天数...</span><span id="times" title="网站运行时间">载入时分秒...</span></div><script>var now=new Date;function createtime(){var n=new Date("02/15/2019 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="————网站已运行"+dnum+"&thinsp;天",document.getElementById("times").innerHTML=hnum+"&thinsp;时"+mnum+"&thinsp;分"+snum+"&thinsp;秒————"}setInterval("createtime()",250)</script><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> 本站访客数 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次 </span><span class="site-pv"><i class="fa fa-eye"></i> 本站总访问量 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/photoswipe.min.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/photoswipe-ui-default.min.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'RVmtcwupIO6WlzPf3zKfb2EW-gzGzoHsz',
        appKey: 'E8jip4oe60SRcVTMAbhG9cyY',
        placeholder: '快来评论吧~',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });</script><script type="text/javascript">// Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });</script><script type="text/javascript" src="/js/src/clipboard.min.js"></script><script type="text/javascript" src="/js/src/clipboard-use.js"></script><script src="/js/src/photoswipe.min.js?v=5.1.4"></script><script src="/js/src/photoswipe-ui-default.min.js?v=5.1.4"></script></body></html>